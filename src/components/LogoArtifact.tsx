import React, { useEffect, useRef } from 'react';
import { gsap } from 'gsap';
import { ScrollTrigger } from 'gsap/ScrollTrigger';

// Registrar ScrollTrigger en GSAP
gsap.registerPlugin(ScrollTrigger);

const ImgServ: React.FC = () => {
  const svgRef = useRef<SVGSVGElement | null>(null);
  
  useEffect(() => {
    const svgElement = svgRef.current;

    if (!svgElement) return;

    const turbwave = svgElement.querySelector('.turbwave');

    if (!turbwave) return;

    // Definir la animación usando GSAP y ScrollTrigger
    gsap.to(turbwave, {
      attr: { baseFrequency: 0 }, // Inicia desde el estado final (baseFrequency alto)
      ease: "none", // Elimina la aceleración para que sea controlada por el scroll
      scrollTrigger: {
        trigger: svgElement, // Dispara la animación cuando el SVG entra en vista
        start: 'top top', // Cuando el usuario empieza a hacer scroll
        end: '+=100%', // Longitud del scroll que se utilizará para la animación
        scrub: true, // Sincroniza la animación con el scroll (avanza o retrocede)
        pin: true, // Mantiene el componente fijado hasta que la animación termine
        markers: false, // Elimina los marcadores de depuración
      },
    });

    // Limpieza cuando el componente se desmonte
    return () => {
      ScrollTrigger.getAll().forEach((trigger) => trigger.kill()); // Elimina los triggers activos
    };
  }, []);

  return (
    <div>
      <div id="box" style={{ marginTop: '5%' }}> {/* Aplicamos el margen superior del -10% */}
        <svg
          ref={svgRef}
          className="mysvg"
          width="1020"
          height="700"
          viewBox="0 0 1280 1426"
          xmlns="http://www.w3.org/2000/svg"
        >
          <defs>
            <filter id="turb">
              <feTurbulence
                className="turbwave"
                type="fractalNoise"
                baseFrequency="0.008" // Comienza con el valor final (distorsionado)
                numOctaves="2"
                result="turbulence_3"
                data-filterId="3"
              />
              <feDisplacementMap
                xChannelSelector="R"
                yChannelSelector="G"
                in="SourceGraphic"
                in2="turbulence_3"
                scale="100"
              />
            </filter>
          </defs>

          {/* Colocamos las rutas (paths) del SVG directamente aquí */}
          <path
            d="M1224.31 1048.19L1234 1134.89C1185.53 1142.43 1168.3 1120.35 1149.45 1081.04C1145.14 1071.88 1139.76 1061.65 1134.37 1061.65C1130.6 1061.65 1126.29 1063.8 1126.29 1074.58V1365.92C1126.29 1389.08 1130.06 1412.77 1143.53 1425.7H1040.13C1053.05 1412.77 1057.36 1389.08 1057.36 1365.92V1074.58C1057.36 1063.8 1052.52 1061.65 1049.28 1061.65C1044.44 1061.65 1038.51 1071.88 1034.21 1081.04C1015.36 1120.35 998.662 1142.43 949.117 1134.89L959.888 1048.19H1224.31Z"
            fill="white"
            filter="url(#turb)"
          />
          <path
            d="M767.224 953.843C750.529 950.074 733.296 950.074 716.063 959.767C666.518 988.848 663.825 1077.71 711.216 1159.02C730.065 1191.87 758.607 1223.65 792.535 1242.5C831.309 1262.96 877.623 1265.12 921.244 1226.88L928.245 1233.88C901.857 1275.89 851.774 1294.73 801.151 1294.73C705.831 1294.73 629.359 1210.19 629.359 1106.79C629.359 1045.39 655.747 990.464 697.753 955.998C726.834 931.764 763.454 917.762 801.151 917.762C818.923 917.762 868.468 924.763 875.469 925.84C893.241 926.917 902.934 926.378 933.092 917.762L925.553 1006.62C898.626 1008.77 878.7 1006.62 860.39 1000.16C843.695 994.233 828.617 985.617 809.768 973.769C796.305 965.691 782.841 958.152 767.224 953.843Z"
            fill="white"
            filter="url(#turb)"
          />
          {/* Resto de los paths del SVG... */}
          <path
            d="M462.925 667.445C459.694 654.52 452.693 649.135 444.076 644.288H527.01L602.405 962.022C607.79 984.641 613.176 1008.87 628.793 1021.26H521.087C532.396 1008.87 537.242 984.641 532.396 962.022L516.778 888.243H427.382C438.152 937.789 444.076 977.101 427.382 1021.26H339.062C360.604 977.101 361.681 938.866 361.681 885.012C362.758 800.463 400.455 703.527 462.925 667.445ZM423.073 870.472H513.009L466.695 681.985C402.609 720.76 410.149 808.002 423.073 870.472Z"
            fill="white"
            filter="url(#turb)"
          />
          <path d="M339.63 631.128C281.469 647.284 250.234 605.817 215.768 584.814C191.534 569.735 176.455 579.429 176.455 604.74V727.525C187.764 710.292 202.304 707.061 218.46 708.138C261.005 710.831 276.083 713.523 310.55 696.829L331.552 753.375C288.47 786.225 255.081 757.683 217.922 736.68C200.15 725.909 180.763 729.141 176.455 753.375V882.084C176.993 905.241 180.763 928.936 193.688 941.323C157.068 941.323 126.91 941.323 90.8281 941.323C103.753 928.936 107.523 905.241 107.523 882.084V624.127C107.523 600.97 103.753 577.274 90.8281 564.35C173.762 564.35 244.31 564.35 327.783 564.35L339.63 631.128Z" fill="white" filter="url(#turb)"/>
          <path d="M1089.09 567.773V825.73C1089.63 848.887 1093.4 872.583 1106.32 884.969C1069.7 884.969 1039.54 884.969 1003.46 884.969C1016.39 872.583 1020.16 848.887 1020.16 825.73V567.773C1020.16 544.616 1016.39 520.921 1003.46 507.996C1039.54 507.996 1069.7 507.996 1106.32 507.996C1093.4 520.921 1089.63 544.616 1089.09 567.773Z" fill="white" filter="url(#turb)"/>
          <path d="M968.831 377.48L978.525 464.184C930.057 471.724 912.823 449.644 893.975 410.331C889.667 401.176 884.281 390.944 878.896 390.944C875.126 390.944 870.818 393.098 870.818 403.869V695.215C870.818 718.372 874.588 742.067 888.051 754.992H784.653C797.577 742.067 801.886 718.372 801.886 695.215V403.869C801.886 393.098 797.039 390.944 793.808 390.944C788.961 390.944 783.037 401.176 778.729 410.331C759.88 449.644 743.186 471.724 693.641 464.184L704.411 377.48H968.831Z" fill="white" filter="url(#turb)"/>
          <path d="M394.406 188.218H480.033C520.423 188.218 568.891 194.68 606.05 218.376C620.59 227.531 632.438 239.378 642.131 252.303C660.442 278.691 663.134 313.696 649.671 339.007C639.439 357.856 621.667 370.242 594.74 372.396C572.122 373.473 547.35 362.702 528.501 348.701C595.818 402.554 674.982 457.484 660.98 565.191H562.967C592.048 484.949 572.661 434.327 527.424 373.473C508.037 346.546 487.573 321.235 480.033 294.847V505.952C480.572 529.109 484.341 552.805 497.266 565.191C460.646 565.191 430.488 565.191 394.406 565.191C407.331 552.805 411.101 529.109 411.101 505.952V247.995C411.101 224.838 407.331 201.143 394.406 188.218ZM480.033 200.604V228.069C480.033 250.688 484.88 278.153 495.112 299.156C511.806 334.16 543.58 339.546 565.66 327.159C583.97 316.927 590.432 298.617 588.817 279.768C586.663 258.227 573.199 235.609 557.043 222.684C536.04 207.066 508.575 200.066 480.033 200.604Z" fill="white" filter="url(#turb)"/>
          <path d="M197.863 23.7292C194.631 10.8044 187.63 5.41906 179.014 0.572266H261.948L337.343 318.307C342.728 340.925 348.113 365.159 363.731 377.545H256.024C267.333 365.159 272.18 340.925 267.333 318.307L251.716 244.528H162.319C173.09 294.073 179.014 333.386 162.319 377.545H74C95.5413 333.386 96.6184 295.15 96.6184 241.296C97.6955 156.747 135.393 59.8109 197.863 23.7292ZM158.011 226.756H247.946L201.632 38.2696C137.547 77.0439 145.086 164.286 158.011 226.756Z" fill="white" filter="url(#turb)"/>
          {/* Puedes seguir añadiendo el resto de los <path> de tu SVG */}
        </svg>
      </div>
    </div>
  );
};

export default ImgServ;
